<!doctype html>
<html class="loading" lang="en" data-textdirection="ltr">

<head>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-GR9E710J6X"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());

		gtag('config', 'G-GR9E710J6X');
	</script>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="Mon, 22 Jul 2002 11:12:01 GMT" />
	<meta name="robots" content="index,follow">
	<meta name="Googlebot" content="index,follow">
	<meta name="revisit-after" content="1 days">
	<link rel="manifest" href="https://cms.htxdbscl.vn/manifest.json">
	<title>Trục dữ liệu lớn Nông nghiệp Đồng Bằng Sông Cửu Long</title>
	<meta name="description" content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" />
	<meta name="keywords" content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" />
	<meta name="news_keywords" content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-title" content="cms.htxdbscl.vn" />
	<link rel="icon" type="image/x-icon" href="/assets/image/logo.png">

	<link rel="canonical" href="https://cms.htxdbscl.vn/" />
	<meta property="og:site_name" content="cms.htxdbscl.vn" />
	<meta property="og:rich_attachment" content="true" />
	<meta property="og:type" content="article" />
	<meta property="article:publisher" content="https://www.facebook.com/cms.htxdbscl.vn" />
	<meta property="og:url" itemprop="url" content="https://cms.htxdbscl.vn/" />
	<meta property="og:image" itemprop="thumbnailUrl" content="/assets/image/logo.png" />
	<meta property="og:image:width" content="800" />
	<meta property="og:image:height" content="600" />
	<meta content="Trục dữ liệu lớn Nông nghiệp Đồng Bằng Sông Cửu Long" property="og:title" itemprop="headline" />
	<meta content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" property="og:description" itemprop="description" />
	<meta content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" property="article:tag" />
	<meta content="news" itemprop="genre" name="medium" />
	<meta content="EN" itemprop="inLanguage" />
	<meta content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" itemprop="articleSection" />
	<meta content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" itemprop="sourceOrganization" name="source" />
	<meta content="2022-01-01T19:22:56+07:00" itemprop="datePublished" name="pubdate" />
	<meta content="2022-01-01T19:22:56+07:00" itemprop="dateModified" name="lastmod" />
	<meta content="2022-01-01T19:22:56+07:00" itemprop="dateCreated" />
	<meta name="copyright" content="cms.htxdbscl.vn" />
	<meta name="author" content="cms.htxdbscl.vn" />

	<meta name="twitter:card" value="summary" />
	<meta name="twitter:url" content="https://cms.htxdbscl.vn/" />
	<meta name="twitter:title" content="Trục dữ liệu lớn Nông nghiệp Đồng Bằng Sông Cửu Long" />
	<meta name="twitter:description" content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" />
	<meta name="twitter:image" content="/assets/image/logo.png" />
	<meta name="twitter:site" content="cms.htxdbscl.vn" />
	<meta name="twitter:creator" content="cms.htxdbscl.vn" />

	<link rel="apple-touch-icon-precomposed" href="/assets/image/logo.png" sizes="72x72">
	<link rel="apple-touch-icon-precomposed" href="/assets/image/logo.png" sizes="144x144">

	<link rel="apple-touch-icon-precomposed" href="/assets/image/logo.png" sizes="57x57">
	<link rel="apple-touch-icon-precomposed" href="/assets/image/logo.png" sizes="114x114">

	<link rel="nokia-touch-icon" href="/assets/image/logo.png">

	<link rel="apple-touch-icon-precomposed" href="/assets/image/logo.png" sizes="1x1">


	<meta name="its_url" content="https://cms.htxdbscl.vn/" />
	<meta name="its_title" content="Trục dữ liệu lớn Nông nghiệp Đồng Bằng Sông Cửu Long" />
	<meta name="its_section" content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" />
	<meta name="its_subsection" content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" />
	<meta name="its_tag" content="Văn phòng điều phối nông nghiệp, nông thôn vùng ĐBSCL
Mô hình thí điểm (V.05_VPĐP.ĐBSCL/DGK)" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<link rel="stylesheet" href="/assets/fonts/bootstrap/bootstrap-icons.css" />
	<link rel="stylesheet" href="/assets/css/main.min.css" />
	<link rel="stylesheet" href="/assets/vendor/overlay-scroll/OverlayScrollbars.min.css" />

	<link rel="stylesheet" href="/assets/vendor/datatables/dataTables.bs5.css" />
	<link rel="stylesheet" href="/assets/vendor/datatables/dataTables.bs5-custom.css" />
	<link rel="stylesheet" href="/assets/vendor/datatables/buttons/dataTables.bs5-custom.css" />

	<script src="https://cdn.maptiler.com/maptiler-sdk-js/v1.2.0/maptiler-sdk.umd.min.js"></script>
	<link href="https://cdn.maptiler.com/maptiler-sdk-js/v1.2.0/maptiler-sdk.css" rel="stylesheet" />
	<script src="https://cdn.maptiler.com/maptiler-weather/v1.1.0/maptiler-weather.umd.min.js"></script>

	<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

	<link rel='stylesheet' href='https://unpkg.com/maplibre-gl@4.0.2/dist/maplibre-gl.css' />
	<script src='https://unpkg.com/maplibre-gl@4.0.2/dist/maplibre-gl.js'></script>

	<script>
		function OnTopPage() {
			$('html, body').animate({ scrollTop: 0 }, 'slow');
		}
		function OpenWindowByToChuc(URLParamater, w = 100, h = 200) {
			var width = screen.width;
			var height = screen.height;
			var width01 = width - w;
			var height01 = height - h;
			var left = (width - width01) / 2;
			var top = (height - height01) / 3;
			var url = "/#/ToChucInfo/" + URLParamater;
			window.open(url, '_blank', 'location=yes,height=' + height01 + ',width=' + width01 + ',scrollbars=yes,status=yes,toolbar=yes,top=' + top + ',left=' + left + '');
		}
	</script>
</head>

<body>
	<style>
		.table-striped,
		.table-striped td,
		.table-striped th {
			border-color: #000000;
			border-style: solid;
			border-width: 1px;
			padding: 2px;
		}

		.table-striped {
			border-collapse: collapse;
		}

		.mat-sort-header-content {
			color: #000000;
			font-weight: bold;
			font-size: 14px;
			text-transform: uppercase;
			width: 100%;
			padding: 10px;
			padding-top: 0px;
			white-space: nowrap;
			display: flex !important;
			text-align: center !important;
			justify-content: center !important;
		}

		.mat-row .mat-cell {
			padding: 10px;
			font-size: 14px;
			white-space: nowrap;
		}

		.mat-row .mat-cell a {
			font-size: 14px;
			white-space: nowrap;
		}

		.mat-row .mat-cell input {
			font-size: 14px;
		}

		.sticky-col {
			position: sticky;
			left: 0;
		}

		input[type="text"],
		input[type="number"],
		label,
		select,
		option {
			font-size: 18px;
		}

		mat-select div,
		mat-option div {
			font-size: 14px;
		}

		.col-12 {
			margin-top: 10px;
			margin-bottom: 10px;
		}

		#map {
			height: 50%;
			margin: 0;
			padding: 0;
		}

		.app-body {
			padding: 0px;
			padding-left: 5px;
			padding-right: 5px;
		}

		.card {
			padding: 0px;
		}

		#FooterBottom {
			width: 100%;
			padding: 10px;
			position: fixed;
			left: 0px;
			bottom: 0px;
			z-index: 2000;
			box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
			background-color: #ffffff;
		}

		#map {
			position: absolute;
			width: 87%;
		}

		@media (max-width: 768px) {
			#map {
				width: 100%;
			}
		}

		#pointer-data {
			z-index: 1;
			position: fixed;
			font-size: 20px;
			font-weight: 900;
			margin: 27px 0px 0px 10px;
			color: #fff;
			text-shadow: 0px 0px 10px #0007;
		}

		#variable-name {
			z-index: 1;
			position: fixed;
			font-size: 20px;
			font-weight: 500;
			margin: 5px 0px 0px 10px;
			color: #fff;
			text-shadow: 0px 0px 10px #0007;
			text-transform: capitalize;
		}

		#time-info {
			position: fixed;
			width: 60vw;
			bottom: 0;
			z-index: 1;
			margin: 10px;
			text-shadow: 0px 0px 5px black;
			color: white;
			font-size: 18px;
			font-weight: 500;
			text-align: center;
			left: 0;
			right: 0;
			margin: auto;
			padding: 20px;
		}

		#time-text {
			font-size: 12px;
			font-weight: 600;
		}

		#time-slider {
			width: 100%;
			height: fit-content;
			left: 0;
			right: 0;
			z-index: 1;
			filter: drop-shadow(0 0 7px #000a);
			margin-top: 10px;
		}

		#buttons {
			width: auto;
			margin: 0 10px;
			padding: 0;
			position: absolute;
			top: 50px;
			left: 0;
			z-index: 99;
		}

		.button {
			display: block;
			position: relative;
			margin: 10px 0 0 0;
			font-size: 0.9em;
		}
	</style>
	<div class="row" style="padding: 10px;">
		<div class="col-lg-3 col-sm-12 col-12">
			<div class="col-lg-12 col-sm-12 col-12">
				<a style="width: 100%; font-size: 18px;" onclick="ToChucToaDoSave()" class="btn btn-info"><i
						class="bi bi-sd-card"></i> Lưu (01 vùng trồng)
				</a>
			</div>
			<div class="col-lg-12 col-sm-12 col-12">
				<label class="form-label">Hợp tác xã</label>
				<br />
				<label class="form-label" id="HTXName"></label>
			</div>
			<div class="col-lg-12 col-sm-12 col-12">
				<label class="form-label">Địa chỉ</label>
				<br />
				<label class="form-label" id="HTXDiaChi"></label>
			</div>
			<div class="col-lg-12 col-sm-12 col-12">
				<label class="form-label">Điện thoại vùng trồng (*)</label>
				<input placeholder="Điện thoại" class="form-control" id="Code">
			</div>
			<div class="col-lg-12 col-sm-12 col-12">
				<label class="form-label">Sản phẩm vùng trồng (*)</label>
				<input placeholder="Sản phẩm" class="form-control" id="Note">
			</div>
			<div class="col-lg-12 col-sm-12 col-12">
				<div class="form-check form-check-inline mb-6">
					<input type="checkbox" class="form-check-input" name="Active" />
					<label class="form-check-label" for="Active" id="Active">Trụ sở (Nếu là trụ sở thì
						chọn một
						điểm)</label>
				</div>
			</div>
		</div>
		<div class="col-lg-9 col-sm-12 col-12">
			<div id="map" style="height: 840px; width: 100%; position: relative;">
				<div style="z-index: 1000; position: absolute; top: 0;">
					<img src="/assets/image/vungtrong.png" />
				</div>
				<div
					style="z-index: 1000; position: absolute; bottom: 0; width: 100%; height: 40px; background-color: #ffffff;">
				</div>
			</div>
		</div>
	</div>
	<script src="/assets/js/jquery.min.js"></script>
	<script src="/assets/js/bootstrap.bundle.min.js"></script>
	<script src="/assets/js/moment.min.js"></script>
	<script src="/assets/vendor/overlay-scroll/jquery.overlayScrollbars.min.js"></script>
	<script src="/assets/vendor/overlay-scroll/custom-scrollbar.js"></script>
	<script src="/assets/vendor/datatables/dataTables.min.js"></script>
	<script src="/assets/vendor/datatables/dataTables.bootstrap.min.js"></script>
	<script src="/assets/vendor/datatables/custom/custom-datatables.js"></script>
	<script src="/assets/js/custom.js"></script>
	<script src="https://www.unpkg.com/turf@3.0.14/turf.min.js"></script>
	<script src="https://www.unpkg.com/@mapbox/mapbox-gl-draw@1.4.3/dist/mapbox-gl-draw.js"></script>
	<link rel="stylesheet" href="https://www.unpkg.com/@mapbox/mapbox-gl-draw@1.4.3/dist/mapbox-gl-draw.css"
		type="text/css" />

	<script>
		let urlParams = new URLSearchParams(window.location.search);
		let ID = urlParams.get('ID');
		let json = {
			ID: ID,
		}

		let latitude = 9.6728475;
		let longitude = 105.518659;
		let polygon = [];
		$.ajax({
			type: 'POST',
			url: 'https://api.cms.htxdbscl.vn/api/v1/ToChuc/GetByIDAsync',
			data: {
				data: JSON.stringify(json)
			},
			dataType: 'json',
			success: function (data) {
				if (data) {
					let HTXName = data.Name;
					let HTXDiaChi = data.DanhMucXaPhuongName + ", " + data.DanhMucQuanHuyenName + ", " + data.DanhMucTinhThanhName;
					document.getElementById("HTXName").innerHTML = HTXName;
					document.getElementById("HTXDiaChi").innerHTML = HTXDiaChi;

					let json = {
						ID: ID,
					}
					$.ajax({
						type: 'POST',
						url: 'https://api.cms.htxdbscl.vn/api/v1/ToChuc/GetSQLByToChucToaDoByIDToListAsync',
						data: {
							data: JSON.stringify(json)
						},
						dataType: 'json',
						success: function (data) {
							let polygonActive = data.filter((item) => item.Active == true);
							let polygonActiveNot = data.filter((item) => item.Active == false);
							if (polygonActive.length > 0) {
								latitude = Number(polygonActive[0].ViDo);
								longitude = Number(polygonActive[0].KinhDo);
							}
							else {
								if (polygonActiveNot.length > 0) {
									latitude = Number(polygonActiveNot[0].ViDo);
									longitude = Number(polygonActiveNot[0].KinhDo);
								}
							}
							MapLoad();


							var el = document.createElement('div');
							el.style.backgroundImage = 'url(https://cms.htxdbscl.vn/Image/HTX4_30.png)';
							el.style.width = '30px';
							el.style.height = '30px';

							let marker = new maptilersdk.Marker({ element: el })
								.setLngLat([longitude, latitude])
								.addTo(map);

							let listCode = [];
							let code = '';
							for (let i = 0; i < polygonActiveNot.length; i++) {
								if (code != polygonActiveNot[i].Code) {
									code = polygonActiveNot[i].Code;
									listCode.push(code);
								}
							}
							for (let i = 0; i < listCode.length; i++) {
								let listPolygon = polygonActiveNot.filter((item) => item.Code == listCode[i]);

								let listPolygonToaDo = [];
								let listPolygonVungTrong = [];

								for (let j = 0; j < listPolygon.length; j++) {
									let latitudeSub = Number(listPolygon[j].ViDo);
									let longitudeSub = Number(listPolygon[j].KinhDo);
									listPolygonToaDo.push([longitudeSub, latitudeSub]);
								}

								listPolygonVungTrong.push(listPolygonToaDo);

								map.on('load', function () {
									let layerID = 'Layer_' + polygonActiveNot[i].DanhMucNgonNguID;
									let sourceID = 'Source_' + polygonActiveNot[i].DanhMucNgonNguID;

									map.addSource(sourceID, {
										'type': 'geojson',
										'data': {
											'type': 'Feature',
											'properties': {
												"name": HTXName,
												"address": HTXDiaChi,
											},
											'geometry': {
												'type': 'Polygon',
												'coordinates': listPolygonVungTrong,
											}
										}
									});
									let color = GetRandomColor();
									map.addLayer({
										'id': layerID,
										'type': 'fill',
										'source': sourceID,
										'paint': {
											'fill-color': color,
											'fill-opacity': 0.5,
											'fill-outline-color': color,
										}
									});
								});
							}
						},
						beforeSend: function () {

						},
						complete: function () {
						}
					});
				}
			},
			beforeSend: function () {

			},
			complete: function () {
			}
		});

		function GetRandomColor() {
			let count = Math.random();
			var arr = [];
			for (var i = 0; i < count; i++) {
				var letters = '0123456789ABCDEF'.split('');
				var color = '#';
				for (var x = 0; x < 6; x++) {
					color += letters[Math.floor(Math.random() * 16)];
				}
			}
			return color;
		}

		map;
		function MapLoad() {
			MapboxDraw.constants.classes.CONTROL_BASE = 'maplibregl-ctrl';
			MapboxDraw.constants.classes.CONTROL_PREFIX = 'maplibregl-ctrl-';
			MapboxDraw.constants.classes.CONTROL_GROUP = 'maplibregl-ctrl-group';

			domain = "https://cms.htxdbscl.vn/";
			domainFull = "https://cms.htxdbscl.vn/#/";



			maptilersdk.config.apiKey = '6iFTqps4QVACLERa26MA';

			map = (window.map = new maptilersdk.Map({
				container: 'map', // container's id or the HTML element to render the map
				style: maptilersdk.MapStyle.HYBRID,  // stylesheet location
				zoom: 12,
				center: [longitude, latitude],
				hash: true,
			}));

			const draw = new MapboxDraw({
				displayControlsDefault: false,
				controls: {
					polygon: true,
					trash: true
				}
			});
			map.addControl(draw);

			map.on('draw.create', updateArea);
			map.on('draw.delete', updateArea);
			map.on('draw.update', updateArea);

			map.on('load', function () {

				map.addSource("HoangSa", {
					"type": "image",
					"url": domain + "assets/image/HoangSa01.png",
					"coordinates": [
						[111.09665858054495, 17.432475898867523],
						[113.11720985517763, 17.38420482529338],
						[112.79285037220984, 15.643938718432054],
						[110.88537855035554, 15.672592116966598],

					]
				});
				map.addLayer({
					"id": "HoangSa",
					"source": "HoangSa",
					"type": "raster",
					"paint": {
						"raster-opacity": 1
					}
				});

				map.addSource("TruongSa", {
					"type": "image",
					"url": domain + "assets/image/TruongSa01.png",
					"coordinates": [
						[112.32373278444106, 12.236103169381323],
						[117.4620551483049, 11.606334626304161],
						[115.59654957671216, 7.357025445897818],
						[110.62186805246108, 7.811210355974268],


					]
				});
				map.addLayer({
					"id": "TruongSa",
					"source": "TruongSa",
					"type": "raster",
					"paint": {
						"raster-opacity": 1
					}
				});
			});
			function updateArea(e) {
				const data = draw.getAll();
				if (data.features.length > 0) {
					const area = turf.area(data);
					const roundedArea = Math.round(area * 100) / 100;
					let features = data["features"];
					let lastIndex = features.length - 1;
					let geometry = features[lastIndex]["geometry"];
					let coordinates = geometry["coordinates"];
					polygon = [];
					for (let i = 0; i < coordinates[0].length; i++) {
						polygon.push(coordinates[0][i]);
					}
				}
			}
		}
		function ToChucToaDoSave() {
			if (polygon) {
				if (polygon.length > 0) {
					let urlParams = new URLSearchParams(window.location.search);
					let ToChucToaDoParentID = urlParams.get('ID');
					Name = new Date().toISOString();
					Code = document.getElementById("Code").value;
					Note = document.getElementById("Note").value;
					Active = document.getElementById("Active").checked;
					IsSave = 0;
					if (ToChucToaDoParentID) {
						if (ToChucToaDoParentID > 0) {
							IsSave = IsSave + 1;
						}
						else {
							alert("Chưa chọn Hợp tác xã");
						}
					}
					else {
						alert("Chưa chọn Hợp tác xã");
					}
					if (Name) {
						if (Name.length > 0) {
							IsSave = IsSave + 1;
						}
						else {
							alert("Chưa nhập nông hộ");
						}
					}
					else {
						alert("Chưa nhập nông hộ");
					}
					if (Code) {
						if (Code.length > 0) {
							IsSave = IsSave + 1;
						}
						else {
							alert("Chưa nhập điện thoại");
						}
					}
					else {
						alert("Chưa nhập điện thoại");
					}
					if (Note) {
						if (Note.length > 0) {
							IsSave = IsSave + 1;
						}
						else {
							alert("Chưa nhập sản phẩm");
						}
					}
					else {
						alert("Chưa nhập sản phẩm");
					}
					if (IsSave == 4) {
						for (let i = 0; i < polygon.length; i++) {
							let json = {
								ID: 0,
								SortOrder: i + 1,
								FileName: "https://cms.htxdbscl.vn/html/MapHopTacXa.html",
								ParentID: ToChucToaDoParentID,
								Name: Name,
								Code: Code,
								Note: Note,
								Active: Active,
								KinhDo: polygon[i][0],
								ViDo: polygon[i][1],
							}
							$.ajax({
								type: 'POST',
								url: 'https://api.cms.htxdbscl.vn/api/v1/ToChucToaDo/SaveAsync',
								data: {
									data: JSON.stringify(json)
								},
								dataType: 'json',
								success: function (data) {
								},
								beforeSend: function () {
								},
								complete: function () {
								}
							});
						}
						alert("Lưu thành công");
					}
				}
				else {
					alert("Chưa chọn vùng trồng hoạc trụ sở");
				}
			}
			else {
				alert("Chưa chọn vùng trồng hoạc trụ sở");
			}
		}
	</script>
</body>

</html>